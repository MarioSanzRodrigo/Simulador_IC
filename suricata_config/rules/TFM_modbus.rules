alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|01|"; offset:7; depth:1; byte_test:2,>,0x07D0,10; msg:"Modbus TFM: 0x01 Read Coils Request excede el valor max de Quantity of Coils"; sid:101; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|81|"; offset:7; depth:1; content:!"|01|"; offset:8; depth:1; content:!"|02|"; offset:8; depth:1; content:!"|03|"; offset:8; depth:1; content:!"|04|"; offset:8; depth:1; msg:"Modbus TFM: 0x01 Read Coils Error codigo de excepcion no permitido"; sid:102; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|02|"; offset:7; depth:1; byte_test:2,>,0x07D0,10; msg:"Modbus TFM: 0x02 Read Discrete Inputs Request, excede el valor max de Quantity of Inputs"; sid:103; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|82|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x02 Read Discrete Inputs Error, codigo de excepcion no permitido"; sid:104; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|03|"; offset:7; depth:1; byte_test:2,>,0x007D,10; msg:"Modbus TFM: 0x03 Read Holding Registers Request, excede el valor max de Quantity of Registers"; sid:105; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|83|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x03 Read Holding Registers Error, codigo de excepcion no permitido"; sid:106; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|04|"; offset:7; depth:1; byte_test:2,>,0x007D,10; msg:"Modbus TFM: 0x04 Read Input Registers Request, excede el valor max de Quantity of Registers"; sid:107; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|84|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x04 Read Input Registers Error, codigo de excepcion no permitido"; sid:108; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|05|"; offset:7; depth:1; content:"!|00 00|"; offset:10, depth:2; content:"!|FF 00|"; offset:10, depth:2;  msg:"Modbus TFM: 0x05 Write Single Coil Request, valor del campo Coil Output no permitido"; sid:109; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|05|"; offset:7; depth:1; content:"!|00 00|"; offset:10, depth:2; content:"!|FF 00|"; offset:10, depth:2; msg:"Modbus TFM: 0x05 Write Single Coil Response, valor de Coil Value no permitido"; sid: 110; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|85|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x05 Write Single Coil Error, codigo de excepcion no permitido"; sid: 111; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|86|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x06 Write Single Register Error, codigo de excepcion no permitido"; sid: 112; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|0F|"; offset:7; depth:1; byte_test: 2,>,0x07B0,10; msg:"Modbus TFM: 0x0F Write Multiple Coils Request: excede el valor max de Quantity of Coils permitido"; sid: 113; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|0F|"; offset:7; depth:1; byte_test: 2,>,0x07B0,10; msg:"Modbus TFM: 0x0F Write Multiple Coils Response, excede el valor max de Quantity of Coils permitido"; sid: 114; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|8F|"; offset:7; depth:1; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM: 0x0F Write Multiple Coils Error, codigo de excepcion no permitido"; sid: 115; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (flow:from_client, established; content:"|00 00|"; offset:2; depth:2; content:"|10|"; offset:7; depth:1; byte_test: 2,>,0x007B,10; msg:"Modbus TFM: 0x10 Write Multiple Registers Request, excede el valor max de Quantity of Registers permitido"; sid: 116; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:"|00 00|"; offset:2; depth:2; content:"|0F|"; offset:7; depth:1; byte_test: 2,>,0x007B,10; msg:"Modbus TFM: 0x10 Write Multiple Response, excede el valor max de Quantity of Registers permitido"; sid: 117; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (flow:from_server, established; content:!"|01|"; offset: 8; depth:1; content:!"|02|"; offset: 8; depth:1; content:!"|03|"; offset: 8; depth:1; content:!"|04|"; offset: 8; depth:1; msg:"Modbus TFM"; sid:118; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> !$MODBUS_SERVER any (msg:"Modbus TFM: comunicacion desde cliente a equipo no autorizado"; sid:119; rev:1; priority:1;)
alert tcp !$MODBUS_CLIENT any -> $MODBUS_SERVER any (msg:"Modbus TFM: comunicacion hacia server de equipo no autorizado"; sid:120; rev:1; priority:1;)
alert tcp $MODBUS_CLIENT any -> $MODBUS_SERVER 504 (msg:"Modbus TFM: Comunicacion legitima cliente-servidor"; sid:121; rev:1; priority:1;)
alert tcp $MODBUS_SERVER 504 -> $MODBUS_CLIENT any (msg:"Modbus TFM: Comunicacion legitima servidor-cliente"; sid:122; rev:1; priority:1;)

alert tcp $MODBUS_SERVER any -> $MODBUS_CLIENT any (msg:"Modbus TFM: Comunicacion legitima servidor-cliente"; sid:123; rev:1; priority:1;)


